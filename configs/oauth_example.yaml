# =============================================================================
# Context Gateway - OAuth Configuration Example
# =============================================================================
# This configuration demonstrates using OAuth (captured Bearer tokens)
# for Claude Code Max/Pro subscribers without requiring an API key.
#
# The gateway captures Authorization: Bearer + anthropic-beta headers
# from incoming requests and reuses them for compression/summarization.
# =============================================================================

metadata:
  name: "OAuth Configuration (Max/Pro Subscribers)"
  description: "Zero-config compression with captured Bearer tokens"
  strategy: "passthrough"

server:
  port: ${GATEWAY_PORT:-18080}
  read_timeout: 30s
  write_timeout: 1000s

urls:
  gateway: "http://localhost:${GATEWAY_PORT:-18080}"

# =============================================================================
# PROVIDERS - OAuth Configuration
# =============================================================================
# For Max/Pro subscribers: Use auth: "oauth" to explicitly capture Bearer
# tokens from incoming Claude Code requests. No API key needed!
#
# The auth field can be:
#   - "api_key" (default): Uses the api_key field for authentication
#   - "oauth": Captures Bearer token from incoming requests
#   - "bedrock": Uses AWS SigV4 signing (requires bedrock.enabled: true)
# =============================================================================

providers:
  anthropic:
    auth: "oauth"  # Explicit: use captured Bearer token from incoming requests
    model: "claude-haiku-4-5-20251001"
    # No api_key needed! Gateway captures token from Claude Code requests

# =============================================================================
# PREEMPTIVE SUMMARIZATION
# =============================================================================

preemptive:
  enabled: true
  trigger_threshold: 85.0
  add_response_headers: true
  
  log_dir: "${SESSION_DIR:-logs}"
  compaction_log_path: "${SESSION_COMPACTION_LOG:-logs/compaction.jsonl}"
  
  summarizer:
    provider: "anthropic"  # Uses OAuth from captured Bearer token

# =============================================================================
# COMPRESSION PIPES (Optional)
# =============================================================================

pipes:
  tool_output:
    enabled: true
    strategy: "external_provider"
    provider: "anthropic"  # Uses OAuth from captured Bearer token
    min_bytes: 256
    max_bytes: 65536

# =============================================================================
# STORE
# =============================================================================

store:
  type: "memory"
  ttl: 1h

# =============================================================================
# MONITORING
# =============================================================================

monitoring:
  log_level: "info"
  log_format: "console"
  log_output: "stdout"
  telemetry_enabled: true
  telemetry_path: "${SESSION_TELEMETRY_LOG:-logs/telemetry.jsonl}"
  compression_log_path: "${SESSION_COMPRESSION_LOG:-logs/compression.jsonl}"
